<h1 align="center">
  <img height="180px" src="https://docs.raito.io/assets/images/raito-logo-half.png" alt="Raito" />
</h1>

<h4 align="center">
  AWS plugin for the Raito CLI
</h4>

<p align="center">
    <a href="/LICENSE.md" target="_blank"><img src="https://img.shields.io/badge/license-Apache%202-brightgreen.svg" alt="Software License" /></a>
    <a href="https://github.com/raito-io/cli-plugin-aws-account/actions/workflows/build.yml" target="_blank"><img src="https://github.com/raito-io/cli-plugin-aws-account/actions/workflows/build.yml/badge.svg" alt="Build status"/></a>
    <a href="https://codecov.io/gh/raito-io/cli-plugin-aws-account" target="_blank"><img src="https://img.shields.io/codecov/c/github/raito-io/cli-plugin-aws-account" alt="Code Coverage" /></a>
</p>

<hr/>

# Raito CLI Plugin - AWS

:rotating_light: :rotating_light: :rotating_light:

**Note: This repository is still in a very early stage of development.  
It contains code that will allow communication with Raito Cloud once it is released.
At this point, no contributions are accepted to the project yet.**

:rotating_light: :rotating_light: :rotating_light:

This Raito CLI plugin implements the integration with AWS It is meant to synchronize an entire AWS account with a data source in Raito Cloud. 
Over time, multiple AWS services will be supported, but at the moment only S3 is supported. The plugin can
 - Synchronize the users and groups from IAM in the AWS account to an identity store in Raito Cloud.
 - Synchronize the AWS S3 meta data (S3 buckets, objects inside those buckets, ...) to a data source in Raito Cloud.
 - Synchronize the access providers from Raito Cloud into IAM/S3 permissions
 - Synchronize the data usage from CloudTrail to Raito Cloud.

<!-- below, TODO -->

## Unsupported features

* To be implemented: wildcards for permissions
* To be implemented: wildcards for resources
* Access-as-code
* Groups in APs

Not planned for now
* Denies as Action in policies
* Permission boundaries
* Bucket Policies
* Bucket ACLs


## Prerequisites
To use this plugin, you will need

1. The Raito CLI to be correctly installed. You can check out our [documentation](http://docs.raito.io/docs/cli/installation) for help on this.
2. A Raito Cloud account to synchronize your AWS account with. If you don't have this yet, visit our webpage at (https://www.raito.io/trial) and request a trial account.
3. Access to your AWS environment. Minimal required permissions still need to be defined. Right now we assume that you're set up with one of the default
authentication options: https://docs.aws.amazon.com/sdkref/latest/guide/standardized-credentials.html#credentialProviderChain. 

A full example on how to start using Raito Cloud with Snowflake can be found as a [guide in our documentation](http://docs.raito.io/docs/guide/cloud).

## Usage
To use the plugin, add the following snippet to your Raito CLI configuration file (`raito.yml`, by default) under the `targets` section:

```yaml
- name: aws-account
  connector-name: raito-io/cli-plugin-aws-account
  data-source-id: "{{DATASOURCE_ID}}"
  identity-store-id: "{{IDENTITYSTORE_ID}}"

  aws-account-id: "{{AWS_ACCOUNT_ID}}"
  
  aws-s3-emulate-folder-structure: <true|false>
  aws-s3-max-folder-depth: 10
  aws-s3-cloudtrail-bucket: "{{AWS_CLOUDTRAIL_BUCKET}}"
```

Next, replace the values of the indicated fields with your specific values, or use [environment variables](https://docs.raito.io/docs/cli/configuration):
- `data-source-id`: the ID of the Data source you created in Raito Cloud.
- `identity-store-id`: the ID of the Identity Store you created in Raito Cloud.
- `aws-account-id`: the ID of the AWS account you want to sync. Make sure to remove the hyphens.

- `aws-s3-emulate-folder-structure`: if set to true, S3 objects will be organized in a folder structure, just as in the AWS console. If set to false, you'll get a flat list of all files within a bucket. 
- `aws-s3-max-folder-depth`: the maximum 'folder depth' that will be synced. 
- `aws-s3-cloudtrail-bucket`: the S3 bucket where S3 usage data generated by AWS CloudTrail is stored.


You will also need to configure the Raito CLI further to connect to your Raito Cloud account, if that's not set up yet.
A full guide on how to configure the Raito CLI can be found on (http://docs.raito.io/docs/cli/configuration).

## Trying it out

As a first step, you can check if the CLI finds this plugin correctly. In a command-line terminal, execute the following command:
```bash
$> raito info raito-io/cli-plugin-aws-account
```

This will download the latest version of the plugin (if you don't have it yet) and output the name and version of the plugin, together with all the plugin-specific parameters to configure it.

When you are ready to try out the synchronization for the first time, execute:
```bash
$> raito run
```
This will take the configuration from the `raito.yml` file (in the current working directory) and start a single synchronization.

Note: if you have multiple targets configured in your configuration file, you can run only this target by adding `--only-targets aws-account` at the end of the command.
